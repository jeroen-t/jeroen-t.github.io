<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Lets create a PowerShell Module and publish it to the PSGallery using GitHub Actions! - Jeroen Trimbach</title><meta name="description" content="A step-by-step tutorial on how to create a PowerShell Module and publish it to the PSGallery by using GitHub Actions"><meta property="og:title" content="Lets create a PowerShell Module and publish it to the PSGallery using GitHub Actions!" />
<meta property="og:description" content="A step-by-step tutorial on how to create a PowerShell Module and publish it to the PSGallery by using GitHub Actions" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jeroentrimbach.com/2021/07/powershell-module-ci/" /><meta property="og:image" content="https://jeroentrimbach.com/2021/07/powershell-module-ci/featured-image.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-28T19:06:05+02:00" />
<meta property="article:modified_time" content="2021-07-31T13:34:05+02:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jeroentrimbach.com/2021/07/powershell-module-ci/featured-image.png"/>
<meta name="twitter:title" content="Lets create a PowerShell Module and publish it to the PSGallery using GitHub Actions!"/>
<meta name="twitter:description" content="A step-by-step tutorial on how to create a PowerShell Module and publish it to the PSGallery by using GitHub Actions"/>
<meta name="application-name" content="jTrimbach">
<meta name="apple-mobile-web-app-title" content="jTrimbach"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://jeroentrimbach.com/2021/07/powershell-module-ci/" /><link rel="prev" href="https://jeroentrimbach.com/2021/06/site-setup/" /><link rel="next" href="https://jeroentrimbach.com/2021/08/azure-bicep-intro/" /><link rel="stylesheet" href="/css/page.min.css"><link rel="stylesheet" href="/css/home.min.css"><meta name="google-site-verification" content="276260495" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Lets create a PowerShell Module and publish it to the PSGallery using GitHub Actions!",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/jeroentrimbach.com\/2021\/07\/powershell-module-ci\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/jeroentrimbach.com\/2021\/07\/powershell-module-ci\/featured-image.png",
                            "width":  1000 ,
                            "height":  500 
                        }],"genre": "posts","keywords": "Blog, PowerShell, Module, GitHub Actions, YAML, CICD","wordcount":  2732 ,
        "url": "https:\/\/jeroentrimbach.com\/2021\/07\/powershell-module-ci\/","datePublished": "2021-07-28T19:06:05+02:00","dateModified": "2021-07-31T13:34:05+02:00","publisher": {
            "@type": "Organization",
            "name": "Jeroen Trimbach"},"author": {
                "@type": "Person",
                "name": "Jeroen Trimbach"
            },"description": "A step-by-step tutorial on how to create a PowerShell Module and publish it to the PSGallery by using GitHub Actions"
    }
    </script></head><body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Jeroen Trimbach"><span class="header-title-pre"><i class='fa fa-terminal'></i> </span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/categories/documentation/"> Docs </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Looking for something?" id="search-input-desktop">
                        <a href="#" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Jeroen Trimbach"><span class="header-title-pre"><i class='fa fa-terminal'></i> </span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Looking for something?" id="search-input-mobile">
                        <a href="#" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/categories/documentation/" title="">Docs</a><a class="menu-item" href="/about/" title="">About</a><div class="menu-item"><a href="javascript:void(0);" class="theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div></div>
    </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single" data-toc="enable"><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/2021/07/powershell-module-ci/featured-image.png"
        data-srcset="/2021/07/powershell-module-ci/featured-image.png, /2021/07/powershell-module-ci/featured-image.png 1.5x, /2021/07/powershell-module-ci/featured-image.png 2x"
        data-sizes="auto"
        alt="/2021/07/powershell-module-ci/featured-image.png"
        title="A step-by-step tutorial on how to create a PowerShell Module and publish it to the PSGallery by using GitHub Actions" /></div><div class="single-card" data-image="true"><h2 class="single-title animated flipInX">Lets create a PowerShell Module and publish it to the PSGallery using GitHub Actions!</h2><h2 class="single-subtitle">A step-by-step tutorial on how to create a PowerShell Module and publish it to the PSGallery by using GitHub Actions</h2><div class="post-meta">
                <div class="post-meta-line"><span class="post-author"><a href="https://jeroentrimbach.com" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jeroen Trimbach</a></span>&nbsp;<span class="post-category">published in <a href="/categories/documentation/"><i class="far fa-folder fa-fw"></i>Documentation</a>&nbsp;<a href="/categories/learning/"><i class="far fa-folder fa-fw"></i>Learning</a></span></div>
                <div class="post-meta-line"><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="28-07-2021">28-07-2021</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2732 words</span>&nbsp;
                    <span><i class="far fa-clock fa-fw"></i>&nbsp;13 minutes</span>&nbsp;</div>
            </div>
            
            <hr><div class="details toc" id="toc-static"  data-kept="">
                    <div class="details-summary toc-title">
                        <span>Contents</span>
                        <span><i class="details-icon fas fa-angle-right"></i></span>
                    </div>
                    <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#u-prerequisites">üìã Prerequisites</a>
      <ul>
        <li><a href="#u-githubaccount">[‚úî] GitHub Account</a></li>
        <li><a href="#u-poshgit">[‚úî] Git in PowerShell</a></li>
        <li><a href="#u-pester">[‚úî] Pester</a></li>
        <li><a href="#u-vscode">[‚úî] Visual Studio code</a></li>
      </ul>
    </li>
    <li><a href="#u-gitrepository">üìÇ Prepare your Git repository</a></li>
    <li><a href="#u-powershellrepo">üìÇ Prepare your PowerShell repository</a></li>
    <li><a href="#u-functions">‚ö° Functions!</a></li>
    <li><a href="#u-psmodule">üì¶ The module file</a></li>
    <li><a href="#u-psmanifest">üìÑ The manifest file</a></li>
    <li><a href="#u-psgallery">üñº PowerShellGallery</a></li>
    <li><a href="#u-githubactions">üî© GithHub Actions</a></li>
    <li><a href="#u-conclusion">üí° Conclusion</a></li>
  </ul>
</nav></div>
                </div><div class="content" id="content"><p>A step-by-step tutorial on how to create a PowerShell Module and publish it to the PSGallery by using GitHub Actions</p>
<p>You might be like me. Use PowerShell daily. Oneliners most of the time. For more advanced tasks you write a script and perhaps schedule those by using Task Scheduler, <br>
the SQL Server Agent or something similar. But creating a PowerShell module? Publishing it to the PowerShellGallery? Crazy!</p>
<p>I&rsquo;m by no means an expert but I got it working. So if you are interested then try to follow along. You might learn something new. I sure did! üòé
<br/><br/></p>
<h2 id="u-prerequisites">üìã Prerequisites</h2>
<hr>
<h3 id="u-githubaccount">[‚úî] GitHub Account</h3>
<p>I&rsquo;m hosting the source code of my module in a Git repository on GitHub. If you are interested in doing the same you should create a GitHub account if you don&rsquo;t already have one. They have a free plan available and the process is straight forward. Just go to their <a href="https://github.com/" target="_blank" rel="noopener noreffer">site</a> to sign up.</p>
<h3 id="u-poshgit">[‚úî] Git in PowerShell</h3>
<p>The posh-git package that provides integration between Git and PowerShell. It will display Git status summary information in your PowerShell prompt and provides support for tab completion when working with Git commands, branches, paths, etc. I want it ü§ó</p>
<p>Follow the process as described on their <a href="https://git-scm.com/book/en/v2/Appendix-A%3A-Git-in-Other-Environments-Git-in-PowerShell" target="_blank" rel="noopener noreffer">site</a> on how to install it.</p>
<h3 id="u-pester">[‚úî] Pester</h3>
<p>Pester is available on Windows 10 or later by default.<br>
You can check whether you have this module installed by running:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-PowerShell" data-lang="PowerShell"><span class="line"><span class="cl"><span class="nb">Get-Module</span> <span class="n">Pester</span> <span class="n">-ListAvailable</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The 3.4.0 version ships as part of Windows 10 and is a bit problematic. To avoid headaches I would suggest updating it right away. Unfortunately updating the module using the Update-Module cmdlet won&rsquo;t work. So you will have to install the latest version of Pester side-by-side using the follow tactic. Open PowerShell as Admin and run the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">Pester</span> <span class="n">-Force</span> <span class="n">-SkipPublisherCheck</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now if you run the following command again:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Get-Module</span> <span class="n">Pester</span> <span class="n">-ListAvailable</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It will display both the shipping and the latest version of Pester.</p>
<h3 id="u-vscode">[‚úî] Visual Studio code</h3>
<p>I highly suggest using a code editor. My editor of choice is Visual Studio Code.</p>
<p>To install VS Code run:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">winget</span> <span class="n">install</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">VisualStudioCode</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition tip">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>the winget tool<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">The winget tool is the client interface to the Windows Package Manager service. You can use it to search for and/or install applications. It also has some other commands in store that allow you to display installed packages, export/import, validate and a bunch of more useful stuff. Once you have it installed simply run <code>winget</code> to see all commands that are available. You can read more about winget <a href="https://docs.microsoft.com/en-us/windows/package-manager/winget/" target="_blank" rel="noopener noreffer">here</a></div>
        </div>
    </div>
<p>And of course if you prefer a different editor yourself than you can use that one instead. 
<br/><br/></p>
<h2 id="u-gitrepository">üìÇ Prepare your Git repository</h2>
<hr>
<p>I hope you have read through the prerequisites and signed up for GitHub because <a href="https://github.com/" target="_blank" rel="noopener noreffer">GitHub</a> is where we start.
We are going to set up the Git repository (repo) for our module.</p>
<p>Click on your profile in the top right of the page. A menu will open. Click on <code>Your repositories</code>. We are going to create a new repository so click on <code>New</code>.</p>
<p>Provide a meaningful name for your repository. I provided the name of the module I created.
Optionally you can give a description for you repository as well.</p>
<p>Another decision you will have to make is whether you want your repository publicly visible or not. Set your repo to either:</p>
<ul>
<li>Public: Anyone on the internet can see this repository. You choose who can commit.</li>
<li>Private: You choose who can see and commit to this repository.</li>
</ul>
<p>You can always change this in the settings of your repository later as well.</p>
<p>Additionaly you can select whether you want to initialize your repository with a README file, a .gitignore file and a license.</p>
<p>Once you have provided all the necessary information press the button <code>Create repository</code> at the bottom of the page.</p>
<p>üéà Congrats on your Repo! üéâ</p>
<p>Now go back to the page that lists all your repositories and open the repository that you have just created. There should be a green button named <code>Code</code>. Press that button and copy the provided URL. Open PowerShell on your machine and browse to your working folder. For this example I am using my home directory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">cd </span><span class="nv">$home</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>clone your Repository by running the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="err">:</span><span class="p">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/&lt;</span><span class="n">username</span><span class="p">&gt;/&lt;</span><span class="n">repository</span><span class="p">&gt;.</span><span class="n">git</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>replace the URL with the one you have copied earlier. Or just replace the tokens with your own details.</p>
<p>There you go! You have your repository locally now. Awesome! I think? A bit empty though..? Hmm, lets work on that!
<br/><br/></p>
<h2 id="u-powershellrepo">üìÇ Prepare your PowerShell repository</h2>
<hr>
<p>// describe what it will look like</p>
<p>e.g.</p>
<ul>
<li>design patterns / folder structure</li>
<li>run Tree utility to show what mine looks like</li>
<li>describe what comes later. E.g. .Github workflow, maybe .vscode/.devcontainer? (or out of scope?)</li>
</ul>
<p>First we will have to think about how we design our repository. We want an ordered folder structure. I have looked at what others have done and most of them have a similar structure as the one that I have used below.</p>
<div class="details admonition tip">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>the tree command<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>The tree command displays the directory structure of a path or of the disk in a drive graphically. It&rsquo;s a very useful tool to quickly get a grasp on how the folder structure is.</p>
<p>Read more about this command <a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/tree" target="_blank" rel="noopener noreffer">here</a></p>
<p>For the example below I ran the command: <code>tree . /F</code>. Where . is the current directory I&rsquo;m in and /F to display files as well.</p>
</div>
        </div>
    </div>
<p>In the root of the repository I have a README and License file. The README file is an important part of your repository. Actually, mine should get some love! üòÖ</p>
<p>The <code>.github</code> and <code>build_scripts</code> folders can be ignored for now. We will cover this later once we start working on our pipeline.</p>
<p>For now create a directory with the name of your module. This is where we are going to create our module and manifest files for our PowerShell module. Within the directory we just created, create another folder with the name <code>functions</code>. This is where we are going to place all our functions.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">JTAZ
</span></span><span class="line"><span class="cl">‚îÇ   LICENSE
</span></span><span class="line"><span class="cl">‚îÇ   README.md
</span></span><span class="line"><span class="cl">‚îÇ   Unit.Tests.xml
</span></span><span class="line"><span class="cl">‚îÇ
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ‚îÄ.github
</span></span><span class="line"><span class="cl">‚îÇ   ‚îî‚îÄ‚îÄ‚îÄworkflows
</span></span><span class="line"><span class="cl">‚îÇ           main.yml
</span></span><span class="line"><span class="cl">‚îÇ
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ‚îÄbuild_scripts
</span></span><span class="line"><span class="cl">‚îÇ       build.ps1
</span></span><span class="line"><span class="cl">‚îÇ
</span></span><span class="line"><span class="cl">‚îî‚îÄ‚îÄ‚îÄjtAz
</span></span><span class="line"><span class="cl">    ‚îÇ   jtAz.psd1
</span></span><span class="line"><span class="cl">    ‚îÇ   jtAz.psm1
</span></span><span class="line"><span class="cl">    ‚îÇ   jtAz.Test.ps1
</span></span><span class="line"><span class="cl">    ‚îÇ
</span></span><span class="line"><span class="cl">    ‚îî‚îÄ‚îÄ‚îÄfunctions
</span></span><span class="line"><span class="cl">            Get-jtAzProviderNamespace.ps1
</span></span><span class="line"><span class="cl">            Get-jtAzResourceTypes.ps1
</span></span><span class="line"><span class="cl">            Get-jtAzTemplate.ps1
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now that we have a skeleton of our PowerShell repository lets commit and push these changes to our repository on GitHub. To do this run the commands:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">git</span> <span class="n">add</span> <span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="n">git</span> <span class="n">commit</span> <span class="n">-m</span> <span class="s2">&#34;first commit&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">main</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now if you check your repository on GitHub your code will be there as well.
<br/><br/></p>
<h2 id="u-functions">‚ö° Functions!</h2>
<hr>
<p>When you are creating a PowerShell module you are going to need to have one or more scripts/functions first.</p>
<p>If you are new to functions have a look at this <a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/ps101/09-functions?view=powershell-7.1" target="_blank" rel="noopener noreffer">documentation</a>.
It might sound intimidating at first but it is a really straight forward process.
Maybe you already have a script available that you might want to turn into a function (because you are using running that script quite often now that you think of it ü§î). Give it a shot! And if you don&rsquo;t have anything existing yet try to come up with something and try doing it with PowerShell. I found myself looking at the <a href="https://docs.microsoft.com/en-us/azure/templates/" target="_blank" rel="noopener noreffer">Azure ARM template documentation</a> quite often but usually need to only have a quick look for reference. So I thought maybe I can create a <a href="https://github.com/jeroen-t/jtAz/blob/main/jtAz/functions/Get-jtAzTemplate.ps1" target="_blank" rel="noopener noreffer">function</a> that will just return the ARM (or Bicep) template from the docs onto my terminal window. So it doesn&rsquo;t have to be revolutionary just try something that sounds useful to you. Dive in. That is how we learn üëç</p>
<p>Once you have created your function save them in the <code>.\&lt;modulename&gt;\functions\</code> folder. Now we can have a look what that psm1 file is all about. üê±‚Äçüèç
<br/><br/></p>
<h2 id="u-psmodule">üì¶ The module file</h2>
<hr>
<p>Next up we have our script module file. As described in the <a href="https://docs.microsoft.com/en-us/powershell/scripting/developer/module/understanding-a-windows-powershell-module?view=powershell-7.1#module-cmdlets-and-variables" target="_blank" rel="noopener noreffer">Microsoft documentation</a> a module is:</p>
<p>&ldquo;A <em>module</em> is a set of related Windows PowerShell functionalities, grouped together as a convenient unit (usually saved in a single directory). By defining a set of related script files, assemblies, and related resources as a module, you can reference, load, persist, and share your code much easier than you would otherwise.&rdquo;</p>
<p>Create a file with the name of your module and save it with the <code>.psm1</code> extension in the folder that also has your module name. Now we could have saved the code of our function in this module file and that would have been a valid and working approach. However, as you can imagine that might become quite cumbersome once you start adding additional functions and/or have to modify them. So instead of doing this we are going to use the functions subfolder, dot source each of our functions and export them.</p>
<p>Save the following code in your module file:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Set-StrictMode</span> <span class="n">-Version</span> <span class="n">Latest</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$functions</span> <span class="p">=</span> <span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="nv">$PSScriptRoot</span><span class="p">\</span><span class="n">functions</span><span class="p">\*.</span><span class="n">ps1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$import</span> <span class="k">in</span> <span class="nv">$functions</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Importing </span><span class="p">$(</span><span class="nv">$import</span><span class="p">.</span><span class="n">FullName</span><span class="p">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span> <span class="nv">$import</span><span class="p">.</span><span class="n">FullName</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Write-Error</span> <span class="s2">&#34;Failed to import function </span><span class="p">$(</span><span class="nv">$import</span><span class="p">.</span><span class="n">FullName</span><span class="p">)</span><span class="s2">: $_&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c">#foreach</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$file</span> <span class="k">in</span> <span class="nv">$functions</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Export-ModuleMember</span> <span class="n">-Function</span> <span class="nv">$file</span><span class="p">.</span><span class="n">BaseName</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c">#foreach</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>dot sourcing the functions will load the functions into memory without executing the code.
<br/><br/></p>
<h2 id="u-psmanifest">üìÑ The manifest file</h2>
<hr>
<p>We are also going to create a manifest file (the one with the .psd1 extension). This is a file that will contain a hashtable with keys and values that describes everything about the module. Think prerequisites, what scripts need to be processed, metadata, versions, etc. We can simply create this file using the <code>New-ModuleManifest</code> PowerShell cmdlet.</p>
<p>Checking the help for this cmdlet will give you all the details:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Get-Help</span> <span class="nb">New-ModuleManifest</span> <span class="n">-Full</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now that we know what we can specify. Lets create one ourselves. Replace <code>SomeModule</code> with the name of your module and replace the values with your own. You can provide additional parameter if you want to.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$ModuleName</span> <span class="p">=</span> <span class="s1">&#39;SomeModule&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$props</span> <span class="p">=</span> <span class="p">@{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Path</span> <span class="p">=</span> <span class="s2">&#34;$ModuleName.psd1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">RootModule</span> <span class="p">=</span> <span class="s2">&#34;$ModuleName.psm1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">GUID</span> <span class="p">=</span> <span class="s2">&#34;</span><span class="p">$(</span><span class="nb">New-Guid</span><span class="p">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Author</span> <span class="p">=</span> <span class="s1">&#39;Jeroen Trimbach&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">CompanyName</span> <span class="p">=</span> <span class="s1">&#39;N/A&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Description</span> <span class="p">=</span> <span class="s2">&#34;beep boop I&#39;m backing up&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ModuleVersion</span> <span class="p">=</span> <span class="s1">&#39;9.9.9&#39;</span> <span class="c"># Leave as is!</span>
</span></span><span class="line"><span class="cl">    <span class="n">FunctionsToExport</span> <span class="p">=</span> <span class="p">@(</span><span class="s1">&#39;&lt;FunctionsToExport&gt;&#39;</span><span class="p">)</span> <span class="c"># leave as is!</span>
</span></span><span class="line"><span class="cl">    <span class="n">CmdletsToExport</span> <span class="p">=</span> <span class="p">@()</span>
</span></span><span class="line"><span class="cl">    <span class="n">VariablesToExport</span> <span class="p">=</span> <span class="p">@()</span>
</span></span><span class="line"><span class="cl">    <span class="n">AliasesToExport</span> <span class="p">=</span> <span class="p">@()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">New-ModuleManifest</span> <span class="nv">@props</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">((</span><span class="nb">Get-content</span> <span class="n">-path</span> <span class="s2">&#34;.\</span><span class="p">$(</span><span class="nv">$ModuleName</span><span class="p">)</span><span class="s2">.psd1&#34;</span><span class="p">)</span> <span class="o">-replace</span> <span class="s1">&#39;9.9.9&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;ModuleVersion&gt;&#39;</span><span class="p">)</span> <span class="p">|</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Set-Content</span> <span class="n">-path</span> <span class="s2">&#34;.\</span><span class="p">$(</span><span class="nv">$ModuleName</span><span class="p">)</span><span class="s2">.psd1&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Have a check at the content of your newly created file. Uncomment keys that seem useful to you and provide values where required. We have not given any function names and module version intentionally. We are going to replace these in our actions workflow because as mentioned earlier whenever we create a new function we want our module to pick that up as well without having to edit the manifest file ourselves. This same idea applies to the ModuleVersion key.</p>
<!-- 
## üìù Running Pester tests {#u-pester}

>> Future content :-) -->
<p><br/><br/></p>
<h2 id="u-psgallery">üñº PowerShellGallery</h2>
<hr>
<p>The plan is that we are going to publish our module to the <a href="www.powershellgallery.com" rel="">PowerShell Gallery</a>. This is a free website maintained by Microsoft.</p>
<p>Register on the website. Once you have an account in the Gallery we want to create a API key. Because whenever we want to publish any package to the PowerShell Gallery we are going to provide this key.</p>
<p>Click on your Profile. It will show a button named <code>API Keys</code>. This will take you to the API Keys page. Click on <code>Create</code>. Provide a name for your key and give an amount of days until the key will expire. The default is 365 days. Now click on <code>Create</code> again at the bottom of the page. Copy the key that is displayed on the screen.</p>
<p>Now we are going to store this key in a safe location from where we can use it in our next steps. Go to your Github repository and click on settings. There will be a menu item called <code>Secrets</code>. This will take you to the <code>Actions secrets</code> page. Click on <code>New repository secret</code> at the top right of the page. Provide a name for your secret (e.g. PSGALLERYAPIKEY) and provide your key. Click on <code>save</code>.</p>
<p>Now we are completely set. Time for <em>Actions</em>! üí•
<br/><br/></p>
<h2 id="u-githubactions">üî© GithHub Actions</h2>
<hr>
<p>Oh, one more step. Remember the values we were going to replace in our manifest file? <br>
Lets do that now. Create a directory in the root of your repository with the name <code>build_scripts</code> or something similar if you haven&rsquo;t already done so. Create a file in there with the name <code>build.ps1</code>. Set the content of that file to:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$Global:ErrorActionPreference</span> <span class="p">=</span> <span class="s1">&#39;Stop&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$Global:VerbosePreference</span> <span class="p">=</span> <span class="s1">&#39;SilentlyContinue&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$buildVersion</span> <span class="p">=</span> <span class="nv">$env:BUILDVER</span>
</span></span><span class="line"><span class="cl"><span class="nv">$manifestPath</span> <span class="p">=</span> <span class="s2">&#34;./jtAz/jtAz.psd1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$publicFuncFolderPath</span> <span class="p">=</span> <span class="s1">&#39;./jtAz/functions&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(!(</span><span class="nb">Get-PackageProvider</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Name</span> <span class="o">-eq</span> <span class="s1">&#39;NuGet&#39;</span> <span class="p">}))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Install-PackageProvider</span> <span class="n">-Name</span> <span class="n">NuGet</span> <span class="n">-force</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">Import-PackageProvider</span> <span class="n">-Name</span> <span class="n">NuGet</span> <span class="n">-force</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">((</span><span class="nb">Get-PSRepository</span> <span class="n">-Name</span> <span class="n">PSGallery</span><span class="p">).</span><span class="n">InstallationPolicy</span> <span class="o">-ne</span> <span class="s1">&#39;Trusted&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Set-PSRepository</span> <span class="n">-Name</span> <span class="n">PSGallery</span> <span class="n">-InstallationPolicy</span> <span class="n">Trusted</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$manifestContent</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-Content</span> <span class="n">-Path</span> <span class="nv">$manifestPath</span> <span class="n">-Raw</span><span class="p">)</span> <span class="o">-replace</span> <span class="s1">&#39;&lt;ModuleVersion&gt;&#39;</span><span class="p">,</span> <span class="nv">$buildVersion</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">((</span><span class="nb">Test-Path</span> <span class="n">-Path</span> <span class="nv">$publicFuncFolderPath</span><span class="p">)</span> <span class="o">-and</span> <span class="p">(</span><span class="nv">$publicFunctionNames</span> <span class="p">=</span> <span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="nv">$publicFuncFolderPath</span> <span class="n">-Filter</span> <span class="s1">&#39;*.ps1&#39;</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-ExpandProperty</span> <span class="n">BaseName</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$funcStrings</span> <span class="p">=</span> <span class="s2">&#34;&#39;</span><span class="p">$(</span><span class="nv">$publicFunctionNames</span> <span class="n">-join</span> <span class="s2">&#34;&#39;,&#39;&#34;</span><span class="p">)</span><span class="s2">&#39;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$funcStrings</span> <span class="p">=</span> <span class="nv">$null</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$manifestContent</span> <span class="p">=</span> <span class="nv">$manifestContent</span> <span class="o">-replace</span> <span class="s2">&#34;&#39;&lt;FunctionsToExport&gt;&#39;&#34;</span><span class="p">,</span> <span class="nv">$funcStrings</span>
</span></span><span class="line"><span class="cl"><span class="nv">$manifestContent</span> <span class="p">|</span> <span class="nb">Set-Content</span> <span class="n">-Path</span> <span class="nv">$manifestPath</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now in your Github repository open the <code>Actions</code> menu. Click on the <code>New workflow</code> button. It will prompt you to choose a workflow template. We will go for <code>set up a workflow yourself</code>. This will open up a file called <code>main.yml</code> in <code>&lt;repo&gt;/.github/workflows/</code>. Replace the contents of that file with the following workflow:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># This is a basic workflow to help you get started with Actions</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">CI</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Controls when the workflow will run</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Triggers the workflow on push or pull request events but only for the main branch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="l">main ]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Allows you to run this workflow manually from the Actions tab</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">publish-to-gallery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l">build</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build and publish</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># API key generated in PSGallery</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">NUGET_KEY</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.PSGALLERYAPIKEY }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">BUILDVER</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;1.0.0&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l">pwsh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">          ./build_scripts/build.ps1
</span></span></span><span class="line"><span class="cl"><span class="sd">          Publish-Module -path ./jtAz -NuGetApiKey $env:NUGET_KEY -Verbose</span><span class="w">          
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Additionaly it might be a good idea to add a job that will run tests on your code first. For PowerShell using Pester is an excellent way to do that. Especially since it is automatic. I will update this post later to include some unit tests and how you can use them in your workflow.</p>
<p>Now click on <code>start commit</code>. Select your workflow and <code>Run workflow</code>! Now it&rsquo;s time to sit back and relax üçø</p>
<p>Your workflow will run and if all goes well it will show a green checkmark ‚úÖ Which also means that you now have your module published to the PowerShell Gallery. They will also send you mail upon succes.</p>
<p>If you get a failure message well then you know what that means.. troubleshoot time. This may or may not have happened to me a few times.. üôÇ
<br/><br/></p>
<h2 id="u-conclusion">üí° Conclusion</h2>
<hr>
<p>In this post we have learned how we can create a PowerShell module using functions that we have stored in separate ps1 files. We have started using a bit of git. And we know now how we can publish our modules to the PS Gallery by using a GitHub Actions workflow.</p>
<p>There is still a lot of room for improvement. We definitely need some tests in there else we are stuck doing that manually and we don&rsquo;t want that.</p>
<p>If you want to learn more about PowerShell then I highly recommend reading through the two books that I have mentioned below. The books are very well written and I have learned a lot from them. Whenever I want to do something in PowerShell but not sure what the correct approach is I try to search in those books first. I will pick up something new most of the times as well.</p>
<ul>
<li>Learn PowerShell in a Month of Lunches - Don Jones, Jeffery Hicks</li>
<li>Learn PowerShell Scripting in a Month of Lunches - Don Jones, Jeffery Hicks</li>
</ul>
<p>Good luck learning üëç</p></div><div class="post-footer" id="post-footer">
    <div class="post-info"><div class="post-info-tag"><span><a href="/tags/blog/">Blog</a>
                </span><span><a href="/tags/powershell/">PowerShell</a>
                </span><span><a href="/tags/module/">Module</a>
                </span><span><a href="/tags/github-actions/">GitHub Actions</a>
                </span><span><a href="/tags/yaml/">YAML</a>
                </span><span><a href="/tags/cicd/">CICD</a>
                </span></div><div class="post-info-line"><div class="post-info-mod">
                <span>Updated on 31-07-2021</span>
            </div><div class="post-info-mod"></div>
        </div><div class="post-info-share">
            <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://jeroentrimbach.com/2021/07/powershell-module-ci/" data-title="Lets create a PowerShell Module and publish it to the PSGallery using GitHub Actions!" data-hashtags="Blog,PowerShell,Module,GitHub Actions,YAML,CICD"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://jeroentrimbach.com/2021/07/powershell-module-ci/" data-hashtag="Blog"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://jeroentrimbach.com/2021/07/powershell-module-ci/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://jeroentrimbach.com/2021/07/powershell-module-ci/" data-title="Lets create a PowerShell Module and publish it to the PSGallery using GitHub Actions!" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://jeroentrimbach.com/2021/07/powershell-module-ci/"><i class="fab fa-reddit fa-fw"></i></a></span>
        </div></div><div class="post-nav"><a href="/2021/06/site-setup/" class="prev" rel="prev" title="How to create a website using Hugo and GitHub Pages"><i class="fas fa-angle-left fa-fw"></i>Previous Post</a>
            <a href="/2021/08/azure-bicep-intro/" class="next" rel="next" title="Azure Bicep: The First Pump">Next Post<i class="fas fa-angle-right fa-fw"></i></a></div></div>
</div><div id="comments" class="single-card"><div id="vssue"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/meteorlxy/vssue">Vssue</a>.
            </noscript></div></article></div>
            </main>
            <footer class="footer"><div class="footer-container"><div class="footer-line">Hosted on GitHub</div><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.99.0">Hugo</a> | Theme - <a href="https://github.com/khusika/FeelIt" target="_blank" rel="noopener noreffer" title="FeelIt 1.0.1"><i class="fas fa-hand-holding-heart fa-fw"></i> FeelIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/"></a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
</div>
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker
        .register('/sw.min.js?version=1.0.1', { scope: '/' })
        .then(() => {
            console.info('Jeroen Trimbach\u00A0Service Worker Registered');
        }, err => console.error('Jeroen Trimbach\u00A0Service Worker registration failed: ', err));

    navigator.serviceWorker
        .ready
        .then(() => {
            console.info('Jeroen Trimbach\u00A0Service Worker Ready');
        });
}
</script>
</footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-chevron-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment-alt fa-fw"></i>
            </a></div><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><link rel="stylesheet" href="/lib/vue/vssue/vssue.min.css"><script src="/lib/vue/vue.runtime.min.js"></script><script src="/lib/vue/vssue/vssue.github.min.js"></script><script src="/lib/autocomplete/autocomplete.min.js"></script><script src="/lib/lunr/lunr.min.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/typeit/typeit.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{"vssue":{"clientID":"af13e32b9a2ab81c4025","clientSecret":"237ea8b4e8aadc30b75ea5e941da285b7b908100","owner":"jeroen-t","repo":"comments","title":"Lets create a PowerShell Module and publish it to the PSGallery using GitHub Actions!"}},"data":{"id-1":"cd ~ # Jeroen Trimbach","id-2":"cd ~ # Jeroen Trimbach"},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":500,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":0,"speed":100}};</script><script src="/js/theme.min.js"></script><script data-goatcounter="https://jeroentrimbach.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>
